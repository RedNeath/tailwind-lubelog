@using CarCareTracker.Helper
@{
    ViewData["Title"] = "Calendar";
}
@inject IConfigHelper config
@inject ITranslationHelper translator
@{
    var userLanguage = config.GetServerLanguage();
}
@section Scripts {
    <script src="~/lib/drawdown/drawdown.js"></script>
}
@section Nav { @translator.Translate(userLanguage, "Calendar") }
@model CalendarViewModel
<div>
    <div class="px-4">
        <div class="flex lg:hidden items-center justify-between">
            <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">@translator.Translate(userLanguage, "Reminders")</h2>
            <div class="flex items-center gap-2">@* Future-proof (not used for now) *@</div>
        </div>
        <hr class="md:hidden border-gray-200 dark:border-gray-800 mt-4"/>
        <div class="lg:grid lg:grid-cols-12 lg:gap-x-4 mt-4 lg:mt-0">
            <div id="calendar" class="mt-8 md:mt-0 text-center lg:col-start-9 lg:col-end-13 lg:row-start-1">
                @await Html.PartialAsync("_Calendar", Model)
            </div>
            <div class="lg:col-span-8 mt-4 lg:mt-0">
                <div class="lg:flex hidden mb-4 items-center justify-between">
                    <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">@translator.Translate(userLanguage, "Reminders")</h2>
                    <div class="flex items-center gap-2">@* Future-proof (not used for now) *@</div>
                </div>
                <div id="reminder-list">
                    @await Html.PartialAsync("_ReminderRecords", Model.CalendarDays.FirstOrDefault(day => day.IsSelected))
                </div>
            </div>
        </div>
    </div>
    
    <dialog id="reminder-record-dialog" class="w-11/12 lg:w-5/12 lg:mt-32 bg-white dark:bg-gray-900 rounded-xl border border-1 border-gray-300 dark:border-gray-700"></dialog>
</div>

<script>
    let selectedDate = new Date();
    
    function selectDate(date, year, month) {
        selectedDate = date;
        getMonth(year, month);
        getRemindersForDate();
    }
    
    function getMonth(year, month) {
        $.get('/Calendar/GetCalendarPartialView', { year: year, month: month, selectedDate: selectedDate.toISOString().split('T')[0] }, function (data) {
            $('#calendar').html(data);
        });
    }
    
    function getRemindersForDate() {
        $.get('/Calendar/GetReminderRecordsPartialView', { selectedDate: selectedDate.toISOString().split('T')[0] }, function (data) {
            $('#reminder-list').html(data);
        });   
    }
</script>
